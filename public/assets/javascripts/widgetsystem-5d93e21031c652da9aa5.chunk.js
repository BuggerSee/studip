(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["widgetsystem"],{

/***/ "XdMw":
/*!***************************************************!*\
  !*** ./resources/assets/stylesheets/widgets.less ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("// extracted by mini-css-extract-plugin\n\n//# sourceURL=webpack:///./resources/assets/stylesheets/widgets.less?");

/***/ }),

/***/ "tWI1":
/*!*************************************************************!*\
  !*** ./resources/assets/javascripts/chunks/widgetsystem.js ***!
  \*************************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var gridstack_dist_gridstack_css__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! gridstack/dist/gridstack.css */ \"eW3N\");\n/* harmony import */ var gridstack_dist_gridstack_css__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(gridstack_dist_gridstack_css__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _stylesheets_widgets_less__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../stylesheets/widgets.less */ \"XdMw\");\n/* harmony import */ var _stylesheets_widgets_less__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_stylesheets_widgets_less__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var gridstack__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! gridstack */ \"9BHx\");\n/* harmony import */ var gridstack__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(gridstack__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var gridstack_dist_gridstack_jQueryUI_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! gridstack/dist/gridstack.jQueryUI.js */ \"JFKa\");\n/* harmony import */ var gridstack_dist_gridstack_jQueryUI_js__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(gridstack_dist_gridstack_jQueryUI_js__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _lib_widget_system_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/widget_system.js */ \"kQhR\");\n/*jslint esversion: 6*/\n\n\n\n\n\n\nfunction addDraggable(element, draggable, width) {\n  var helper = draggable.clone();\n  var recreate = false;\n  element.append(helper.width(width));\n  helper.draggable({\n    appendTo: 'body',\n    helper: function helper() {\n      return $(this).clone().css({\n        zIndex: 1000\n      });\n    },\n    revert: function revert(droppable) {\n      if (droppable !== false) {\n        addDraggable(element, draggable, width);\n        $('#layout-sidebar').removeClass('second-display');\n        return false;\n      }\n\n      recreate = true;\n      return true;\n    },\n    stop: function stop() {\n      // Recreate draggable after revert. This is neccessary since\n      // gridstack occassionally fails with \"origNode._grid is\n      // undefined\". This will prevent that.\n      if (recreate) {\n        helper.draggable('destroy').remove();\n        addDraggable(element, draggable, width);\n      }\n    }\n  });\n}\n\nfunction getAddableWidgetList(url) {\n  return $.Deferred(function (dfd) {\n    if ($('#layout-sidebar .sidebar-secondary-widget').length > 0) {\n      return dfd.resolve();\n    }\n\n    $.get(url).then(function (response) {\n      var content = $(response);\n      var container_id = $('.addable-widgets', content).data().containerId;\n      var widgetsystem = STUDIP.WidgetSystem.get(container_id);\n      var elements = $('.addable-widgets div[data-widget-id]', content);\n      var one_width = Math.floor($(widgetsystem.grid).width() / widgetsystem.width);\n      $(content).appendTo('#layout-sidebar > .sidebar');\n      $(elements).each(function () {\n        var widget_id = $(this).data().widgetId;\n        var title = $('h2', this).html();\n        var contents = $(this).children(':not(h2)').clone();\n        var helper = $('<div class=\"grid-stack-item widget-to-add\" data-gs-width=\"1\" data-gs-height=\"1\">');\n        var body = $('<div class=\"grid-stack-item-content has-layout\">').appendTo(helper);\n        var header = $('<header class=\"widget-header\">').appendTo(body);\n        helper.attr('data-widget-id', widget_id);\n        $('<h2 class=\"widget-title\">').html(title).appendTo(header);\n        $('<article class=\"widget-content\">').append(contents).appendTo(body);\n        addDraggable($(this).parent(), helper, one_width);\n      }); // This will position the addable widget under the mouse cursor\n      // so that the whole li containing the widget may be used to\n      // drag the element to the grid. Otherwise there's a gap to the\n      // right.\n\n      $('#layout-sidebar .addable-widgets li').on('mousemove', function (event) {\n        var offset = $(this).offset();\n        var position = {\n          left: event.pageX - offset.left - 16,\n          top: event.pageY - offset.top - 16\n        };\n        $('.widget-to-add', this).css(position);\n      });\n      dfd.resolve();\n    }, dfd.reject);\n  }).promise();\n}\n\n$(document).on('widget-add', function (event, jqxhr) {\n  var remove = jqxhr.getResponseHeader('X-Widget-Remove');\n  var widget_id = jqxhr.getResponseHeader('X-Widget-Id');\n\n  if (remove) {\n    $('.addable-widgets li:has([data-widget-id=\"' + widget_id + '\"])').each(function () {\n      var _this = this;\n\n      $('.ui-draggable', this).draggable('destroy');\n      $(this).slideUp(function () {\n        return $(_this).remove();\n      });\n    });\n  }\n}).on('widget-remove', function (event, jqxhr) {\n  if (jqxhr.getResponseHeader('X-Refresh')) {\n    $('#layout-sidebar .sidebar-secondary-widget').remove();\n  }\n}).on('click', function (event) {\n  if ($(event.target).closest('.sidebar-secondary-widget').length === 0) {\n    $('#layout-sidebar').removeClass('second-display');\n  }\n});\n$('#layout-sidebar').on('click', '.widget-add-toggle', function () {\n  getAddableWidgetList(this.href).done(function () {\n    $('#layout-sidebar').toggleClass('second-display');\n  });\n  return false;\n});\nSTUDIP.WidgetSystem = _lib_widget_system_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"];\n\n//# sourceURL=webpack:///./resources/assets/javascripts/chunks/widgetsystem.js?");

/***/ })

}]);